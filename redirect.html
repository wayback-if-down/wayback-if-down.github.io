<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    </head>
    <body>
        <div class="container text-center">
            <div id="checking" class="d-none">
                ‚è≥ Checking <a>[placeholder]</a> for you ...
            </div>
            <div id="missing" class="d-none">
                ‚ö†Ô∏è You didn't specify a URL. Create a valid link at <a href="https://wayback-if-down.github.io">https://wayback-if-down.github.io</a>.
            </div>
            <div id="broken" class="d-none">
                üòî Sorry, <a>[placeholder]</a> does not seem to be available online.
            </div>
            <div id="live" class="d-none">
                üöÄ <a>[placeholder]</a> is live. Taking you there ...
            </div>
            <div id="archived" class="d-none">
                üóÉÔ∏è <a>[placeholder]</a> is broken, but it has been archived. Taking you there ...
            </div>
            <div id="error" class="d-none">
                üí• Uh oh, something went wrong. Check the logs!
            </div>
        </div>
        <script>
            // Update one of the notice elements with the given url and display it.
            function updateNotice(id, url) {
                const element = document.getElementById(id);
                const a = element.getElementsByTagName("a")[0];
                a.textContent = url;
                a.setAttribute("href", url);
                element.classList.remove("d-none");
            }

            (async function() {
                // Get the querystring and redirect to the main site if not available.
                const href = new URL(window.location.href);
                const url = href.searchParams.get("url");
                if (!url) {
                    document.getElementById("missing").classList.remove("d-none");
                    return;
                } else {
                    updateNotice("checking", url);
                }

                // Get the redirect information from the server. The payload looks like
                // {status: "broken"|"live"|"archived", redirectUrl: str}
                const redirectUrl = new URL(
                    href.hostname == "localhost" ? "http://127.0.0.1:5000/json" :
                    "https://wayback-if-down.ue.r.appspot.com/json"
                );
                redirectUrl.searchParams.set("url", url);
                const response = await fetch(redirectUrl);
                const payload = await response.json();
                const checkingElement = document.getElementById("checking");
                checkingElement.classList.add("d-none");
                checkingElement.classList.remove("d-flex");

                // Update the content of the page and redirect if available.
                updateNotice(payload.status, url);
                if (payload.redirectUrl) {
                    window.location.href = payload.redirectUrl;
                }
            })();
        </script>
    </body>
</html>
